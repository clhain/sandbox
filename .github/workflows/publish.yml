name: Publish

on:
  push:
    branches:
      - master

jobs:
  call-check-codeowners:
    uses: ./.github/workflows/check-codeowners.yml
  call-lint:
    uses: ./.github/workflows/linter.yml
  
  check-update-paths:
    runs-on: ubuntu-latest
    outputs:
      bundle-changed: ${{ steps.filter.outputs.bundle }}
      docs-changed: ${{ steps.filter.outputs.docs }}
      services-changed: ${{ steps.filter.outputs.services }}
    steps:
    - uses: dorny/paths-filter@v2
      id: filter
      with:
        base: master
        filters: |
          bundle:
            - 'bundle/**'  
          docs:
            - 'docs/**'  
          services:
            - 'services/**'
    - name: test
      run: |
        ${{ steps.filter.outputs.bundle }} && echo "bundle=true"
        ${{ steps.filter.outputs.docs }} && echo "bundle=true"
        ${{ steps.filter.outputs.services }} && echo "bundle=true"

  docs-publish:
    needs: check-update-paths
    if: needs.check-update-paths.outputs.docs-changed
    uses: ./.github/workflows/docs-publish.yml

  bundle-publish:
    needs: check-update-paths
    if: needs.check-update-paths.outputs.bundle-changed
    uses: ./.github/workflows/bundle-publish.yml