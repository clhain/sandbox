<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://clhain.github.io/sandbox/services/prometheus-operator/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Prometheus Operator - Sandbox Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Prometheus Operator";
        var mkdocs_page_input_path = "services/prometheus-operator.md";
        var mkdocs_page_url = "/sandbox/services/prometheus-operator/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Sandbox Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/quick-start/">Quick Start</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/getting-started/">Getting Started</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/pre-reqs/">Common Pre-Reqs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/dns/">DNS Configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/byoc-helm/">Bring Your Own Cluster (Helm)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/byoc-argocd/">Bring Your Own Cluster (ArgoCD)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/all-in-one-gke/">All-In-One (GKE)</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Customization</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../customization/deploy-an-app/">Deploy Your App</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Sandbox Apps</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../argocd/">ArgoCD</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cert-manager/">Cert Manager</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gatekeeper/">OPA Gatekeeper</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../grafana/">Grafana</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../loki/">Loki</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../nginx-ingress/">NGINX Kubernetes Ingress</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../nginx-mesh/">NGINX Service Mesh</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../oauth-proxy/">Oauth2 Proxy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../opentelemetry-operator/">Opentelemetry Operator</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Prometheus Operator</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#quick-links">Quick Links</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#background">Background</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sandbox-customizations">Sandbox Customizations</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#enable-metrics-collection-for-a-service-pod">Enable Metrics Collection For A Service / Pod</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sealed-secrets/">Sealed Secrets</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tempo/">Tempo</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Misc</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/">Troubleshooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../faq/">Frequently Asked Questions</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Sandbox Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Sandbox Apps &raquo;</li>
      <li>Prometheus Operator</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="sandbox-service-prometheus-operator">Sandbox Service: Prometheus Operator</h1>
<h2 id="quick-links">Quick Links</h2>
<ul>
<li><a href="https://prometheus.io/">Project Site</a></li>
<li><a href="https://github.com/prometheus-operator/prometheus-operator">Github Repo</a></li>
<li><a href="https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack">Helm Chart</a></li>
</ul>
<h2 id="background">Background</h2>
<p>Prometheus is the default Metrics collection, storage, and query engine for the Sandbox Platform. It's deeply
integrated with Kubernetes, and monitors all aspects of the cluster and most Sandbox Apps automatically. It has
repeatable patterns for integrating metrics collection for your own applications, and is automatically configured
as a datasource for the Sandbox Grafana instance.</p>
<h2 id="sandbox-customizations">Sandbox Customizations</h2>
<p>The Sandbox installation of prometheus Operator includes a mostly default installation with the following modifications:</p>
<ul>
<li>Prometheus adapter is included to allow Kubernetes to leverage custom metrics (nginx based ones by default) for autoscaling.</li>
<li>Grafana provisioning is disabled (handled through a dedicated Grafana chart).</li>
<li>Datasource and dashboard deployments are forced despite Grafana being disabled.</li>
<li>Remote Write Receiver is enabled (to allow remote write from Opentelemetry Collector).</li>
<li>Custom scrape jobs are included to ingest mesh and ingress data.</li>
</ul>
<p>Values can be passed to the official prometheus-adapter chart (by adding them under the "prometheus-adapter:" key),
as shown on line 1 of the values file. Values can be passed to the official kube-prometheus-stack chart (by adding them under the "kube-prometheus-stack:" key),
as shown on line 4 of the values file</p>
<pre><code>prometheus-adapter:
  ...

kube-prometheus-stack:
  grafana:
    enabled: false
    forceDeployDatasources: true
    forceDeployDashboards: true
    sidecar:
      dashboards:
        annotations:
          grafana_folder: Kubernetes
  prometheus:
    prometheusSpec:
      serviceMonitorSelectorNilUsesHelmValues: false
      enableRemoteWriteReceiver: true
      additionalScrapeConfigs:
        - job_name: 'nginx-mesh-sidecars'
        ...
</code></pre>
<p>See <a href="../../customization/default-services/">Customizing Default Services</a> for more information on overriding default values.</p>
<h2 id="enable-metrics-collection-for-a-service-pod">Enable Metrics Collection For A Service / Pod</h2>
<p>Metrics collection can be enabled for your service using ServiceMonitor and PodMonitor spec. Here is the servicemonitor
definition deployed by the Opentelemetry Operator helm chart.</p>
<pre><code>apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: otc
  namespace: opentelemetry-operator
spec:
  endpoints:
  - port: monitoring
  namespaceSelector:
    matchNames:
    - opentelemetry-operator
  selector:
    matchLabels:
      app.kubernetes.io/name: otc-collector-monitoring
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../opentelemetry-operator/" class="btn btn-neutral float-left" title="Opentelemetry Operator"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../sealed-secrets/" class="btn btn-neutral float-right" title="Sealed Secrets">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../opentelemetry-operator/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../sealed-secrets/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
